<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mini LinkedIn - API Test</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen';
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f3f2ef;
        }
        .container {
            background: white;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            padding: 20px;
            margin-bottom: 20px;
        }
        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 25px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            background: linear-gradient(135deg, #0a66c2, #004182);
            color: white;
            margin: 5px;
        }
        .btn:hover {
            background: linear-gradient(135deg, #004182, #003366);
        }
        input, textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            margin: 10px 0;
            font-size: 14px;
        }
        .post {
            border: 1px solid #eee;
            border-radius: 8px;
            padding: 15px;
            margin: 10px 0;
            background: #fafafa;
        }
        .post-header {
            font-weight: bold;
            color: #0a66c2;
            margin-bottom: 5px;
        }
        .post-meta {
            color: #666;
            font-size: 12px;
            margin-bottom: 10px;
        }
        .error {
            color: #e74c3c;
            background-color: #fdeaea;
            border: 1px solid #f5b7b1;
            padding: 12px;
            border-radius: 8px;
            margin: 10px 0;
        }
        .success {
            color: #27ae60;
            background-color: #eafaf1;
            border: 1px solid #a9dfbf;
            padding: 12px;
            border-radius: 8px;
            margin: 10px 0;
        }
        .header {
            text-align: center;
            color: #0a66c2;
            margin-bottom: 30px;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>üíº Mini LinkedIn - API Test</h1>
        <p>Testing the Mini LinkedIn Community Platform APIs</p>
    </div>

    <!-- Authentication Section -->
    <div class="container">
        <h2>üîê Authentication</h2>
        <div>
            <h3>Register</h3>
            <input type="text" id="regName" placeholder="Full Name" value="Alice Cooper">
            <input type="email" id="regEmail" placeholder="Email" value="alice@example.com">
            <input type="password" id="regPassword" placeholder="Password" value="password123">
            <input type="text" id="regJobTitle" placeholder="Job Title" value="Product Manager">
            <input type="text" id="regLocation" placeholder="Location" value="Seattle, WA">
            <textarea id="regBio" placeholder="Bio">Product Manager with 5 years of experience in tech startups.</textarea>
            <button class="btn" onclick="register()">Register</button>
        </div>
        
        <div>
            <h3>Login</h3>
            <input type="email" id="loginEmail" placeholder="Email" value="john@example.com">
            <input type="password" id="loginPassword" placeholder="Password" value="password123">
            <button class="btn" onclick="login()">Login</button>
        </div>
        
        <div id="authResult"></div>
        <div id="currentUser"></div>
    </div>

    <!-- Posts Section -->
    <div class="container">
        <h2>üìù Posts</h2>
        <div>
            <textarea id="postContent" placeholder="What's on your mind?">Just tested the API endpoints - everything is working great! üöÄ</textarea>
            <button class="btn" onclick="createPost()">Create Post</button>
            <button class="btn" onclick="loadPosts()">Load Posts</button>
        </div>
        <div id="postsResult"></div>
        <div id="postsList"></div>
    </div>

    <!-- Search Section -->
    <div class="container">
        <h2>üîç Search</h2>
        <input type="text" id="searchQuery" placeholder="Search posts and users..." value="React">
        <button class="btn" onclick="searchPosts()">Search</button>
        <div id="searchResults"></div>
    </div>

    <script>
        const API_BASE = 'http://localhost:5000/api';
        let currentToken = null;
        let currentUser = null;

        // Authentication Functions
        async function register() {
            const data = {
                name: document.getElementById('regName').value,
                email: document.getElementById('regEmail').value,
                password: document.getElementById('regPassword').value,
                job_title: document.getElementById('regJobTitle').value,
                location: document.getElementById('regLocation').value,
                bio: document.getElementById('regBio').value
            };

            try {
                const response = await fetch(`${API_BASE}/auth/register`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(data)
                });

                const result = await response.json();
                
                if (response.ok) {
                    currentToken = result.token;
                    currentUser = result.user;
                    showResult('authResult', `‚úÖ Registration successful! Welcome ${result.user.name}`, 'success');
                    updateCurrentUser();
                } else {
                    showResult('authResult', `‚ùå Registration failed: ${result.message}`, 'error');
                }
            } catch (error) {
                showResult('authResult', `‚ùå Registration error: ${error.message}`, 'error');
            }
        }

        async function login() {
            const data = {
                email: document.getElementById('loginEmail').value,
                password: document.getElementById('loginPassword').value
            };

            try {
                const response = await fetch(`${API_BASE}/auth/login`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(data)
                });

                const result = await response.json();
                
                if (response.ok) {
                    currentToken = result.token;
                    currentUser = result.user;
                    showResult('authResult', `‚úÖ Login successful! Welcome back ${result.user.name}`, 'success');
                    updateCurrentUser();
                } else {
                    showResult('authResult', `‚ùå Login failed: ${result.message}`, 'error');
                }
            } catch (error) {
                showResult('authResult', `‚ùå Login error: ${error.message}`, 'error');
            }
        }

        function updateCurrentUser() {
            if (currentUser) {
                document.getElementById('currentUser').innerHTML = `
                    <div class="success">
                        <strong>Logged in as:</strong> ${currentUser.name} (${currentUser.email})<br>
                        <strong>Job Title:</strong> ${currentUser.job_title || 'Not specified'}<br>
                        <strong>Location:</strong> ${currentUser.location || 'Not specified'}
                    </div>
                `;
            }
        }

        // Posts Functions
        async function createPost() {
            const content = document.getElementById('postContent').value;
            
            if (!content.trim()) {
                showResult('postsResult', '‚ùå Please enter some content', 'error');
                return;
            }

            try {
                const response = await fetch(`${API_BASE}/posts`, {
                    method: 'POST',
                    headers: { 
                        'Content-Type': 'application/json',
                        ...(currentToken && { 'Authorization': `Bearer ${currentToken}` })
                    },
                    body: JSON.stringify({ content })
                });

                const result = await response.json();
                
                if (response.ok) {
                    showResult('postsResult', '‚úÖ Post created successfully!', 'success');
                    document.getElementById('postContent').value = '';
                    loadPosts(); // Reload posts
                } else {
                    showResult('postsResult', `‚ùå Failed to create post: ${result.message}`, 'error');
                }
            } catch (error) {
                showResult('postsResult', `‚ùå Post creation error: ${error.message}`, 'error');
            }
        }

        async function loadPosts() {
            try {
                const response = await fetch(`${API_BASE}/posts`);
                const posts = await response.json();
                
                if (response.ok) {
                    displayPosts(posts, 'postsList');
                    showResult('postsResult', `‚úÖ Loaded ${Array.isArray(posts) ? posts.length : 1} posts`, 'success');
                } else {
                    showResult('postsResult', `‚ùå Failed to load posts: ${posts.message}`, 'error');
                }
            } catch (error) {
                showResult('postsResult', `‚ùå Posts loading error: ${error.message}`, 'error');
            }
        }

        // Search Functions
        async function searchPosts() {
            const query = document.getElementById('searchQuery').value;
            
            if (!query.trim()) {
                showResult('searchResults', '‚ùå Please enter a search query', 'error');
                return;
            }

            try {
                const response = await fetch(`${API_BASE}/posts/search?q=${encodeURIComponent(query)}`);
                const result = await response.json();
                
                if (response.ok) {
                    const posts = result.posts || [];
                    displayPosts(posts, 'searchResults');
                    showResult('searchResults', `‚úÖ Found ${posts.length} posts matching "${query}"`, 'success');
                } else {
                    showResult('searchResults', `‚ùå Search failed: ${result.message}`, 'error');
                }
            } catch (error) {
                showResult('searchResults', `‚ùå Search error: ${error.message}`, 'error');
            }
        }

        // Helper Functions
        function showResult(elementId, message, type) {
            const element = document.getElementById(elementId);
            element.innerHTML = `<div class="${type}">${message}</div>`;
        }

        function displayPosts(posts, containerId) {
            const container = document.getElementById(containerId);
            
            if (!Array.isArray(posts)) {
                posts = [posts];
            }
            
            if (posts.length === 0) {
                container.innerHTML = '<div class="post">No posts found.</div>';
                return;
            }

            container.innerHTML = posts.map(post => `
                <div class="post">
                    <div class="post-header">
                        ${post.author_name || 'Unknown User'}
                        ${post.author_job_title ? ` - ${post.author_job_title}` : ''}
                    </div>
                    <div class="post-meta">
                        Posted on ${new Date(post.created_at).toLocaleString()}
                        ${post.likes_count ? ` ‚Ä¢ ${post.likes_count} likes` : ''}
                    </div>
                    <div>${post.content}</div>
                </div>
            `).join('');
        }

        // Load posts on page load
        window.onload = function() {
            loadPosts();
        };
    </script>
</body>
</html>
